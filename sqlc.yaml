version: '2'
sql:
  - engine: postgresql
    schema: internal/db/migrations
    queries: internal/db/queries
    gen:
      go:
        package: sqlc
        out: internal/db/sqlc
        sql_package: 'pgx/v5'
        emit_pointers_for_null_types: true
        emit_json_tags: true
        emit_db_tags: true
        emit_interface: false
        overrides:
          # timestamptz to time.Time (pgx compatible)
          - db_type: 'timestamptz'
            nullable: true
            go_type:
              type: 'time.Time'
              pointer: true
          - db_type: 'timestamptz'
            nullable: false
            go_type:
              type: 'time.Time'

          # double precision to float64
          - db_type: 'double precision'
            nullable: false
            go_type:
              type: 'float64'
          - db_type: 'double precision'
            nullable: true
            go_type:
              type: 'float64'
              pointer: true

          # int to int32
          - db_type: 'pg_catalog.int4'
            nullable: false
            go_type:
              type: 'int32'
          - db_type: 'pg_catalog.int4'
            nullable: true
            go_type:
              type: 'int32'
              pointer: true

          # pg uuid to google/uuid
          - db_type: 'uuid'
            nullable: false
            go_type:
              import: 'github.com/google/uuid'
              type: 'UUID'
          - db_type: 'uuid'
            nullable: true
            go_type:
              import: 'github.com/google/uuid'
              type: 'UUID'
              pointer: true

          # date to time.Time
          - db_type: 'date'
            nullable: false
            go_type:
              type: 'time.Time'
          - db_type: 'date'
            nullable: true
            go_type:
              type: 'time.Time'
              pointer: true

          # map columns directly to proto enums
          - column: 'accounts.account_type'
            go_type:
              import: 'null/internal/gen/null/v1'
              type: 'AccountType'
          - column: 'transactions.tx_direction'
            go_type:
              import: 'null/internal/gen/null/v1'
              type: 'TransactionDirection'
